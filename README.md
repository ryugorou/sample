
## 1. 概要

 本書は、デジタルコンテンツプラットフォーム（以下「PF」）上で動作するコンテンツの作成情報を記したものです。

 尚、コンテンツのデザインについてはデザインガイドラインをご参照ください。

### 1-1. 本書での用語について  

| 用語 | 解説 |
|---------|----------|
| コンテンツ | デジタルコンテンツ(デジタル教材)を指します。<br>サムネイル、紹介動画、デモ、実コンテンツを標準構成とします。<br>また、PFと連携するために、以下の機能を必要とします。<br>  |
| PF | 本書の仕様に基づいて作成されたコンテンツを動作させる本体機能を指します。<br> コンテンツ管理等の基本機能、コンテンツを表示するビューア機能、コンテンツと連携する共有機能で構成します。   |
| 共有機能 | 全てのコンテンツが利用可能なPFの共有機能を指します。  <br>※詳細は後述します。


### 1-2. コンテンツの制作における遵守事項  

### 1-3. コンテンツ制作者が自由にできること  

## 2. コンテンツの仕様
### 2-1. 記述言語  
コンテンツの作成にはHTML5、CSS3を使用します。  
HTML5で実現できない機能については、Flashや外部ファイルの実行も可能です。  
ただし、Windows以外で動作しない可能性があることを考慮してください。  
JavaScriptは任意の外部ライブラリを使用可能です。

### 2-2. 動作環境

#### 2-2-1. Windows版  
Windows版PFは、端末にインストールされているインターネットエクスプローラ（IE）を内部で使用して、コンテンツを動作させます。  
そのため、対象となるブラウザのバージョンは、HTML5を正式サポートしている、IE9以降とします。

#### 2-2-2. iOS版  
iOS版PFは、iOSで提供されるUIWebView機能を使用します。  
iOSのバージョンは7.0以降とします。

#### 2-2-3. Android版  
Android版PFは、Androidで提供されるWebView機能または、WebViewを拡張して使用します。  
Androidのバージョンは4.x以降とします。

### 2-3. 起動方法  
コンテンツの起動には2通りの方法があります。

#### 2-3-1. PFへインストール  
サーバからダウンロードしてインストールする方法と、CD-ROMからインストール方法があります。  
いずれの場合もPF上から操作します。  
※サーバからダウンロードする場合は、PFでの認証が必要になります。

#### 2-3-2. CD-ROMから直接起動  
CD-ROM上のPFを起動し、そこからCD-ROM上のコンテンツを起動します。  
インストール不要ですが、学習履歴の保存など、一部の機能は利用できません。

### 2-4. フォルダ構成  
フォルダの構成は以下の通りとします。  
任意にフォルダを追加して頂いても構いませんが、後述する必須ファイルについては、決められた階層に作成する必要があります。  
任意に追加できるフォルダ、その場所を指定して下さい。  
以下の表について：
ルートとは何か？
各ファイルの用途を記述して下さい  
コンテンツはContentsやIntroductionの配下のどこに格納されますか？  
できれば、コンテンツ制作者の世界を一つのフォルダの中に指定したい。  
＞フォルダ構成はコンテンツを利用する流れが完成してから決める。  
＞コンテンツとデモで分けてZIP化するのが良いかもしれない。  
メインコンテンツ
```
/(ルート)
├─Contents 			PFのコンテンツ用フォルダ
│  │  contents.xml		必須のXMLファイル
│  │  index.html		必須のHTMLファイル
│  │
│  ├─css			スタイルシートを格納するフォルダ
│  │  │  common.css
│  │  │  reset.css		標準の設定を無効化するCSSファイル
│  │  │
│  │  ├─high		高解像度の場合に使用するCSSフォルダ
│  │  │      contents.css
│  │  │
│  │  ├─low		低解像度の場合に使用するCSSフォルダ
│  │  │      contents.css
│  │  │
│  │  └─middle		中解像度の場合に使用するCSSフォルダ
│  │          contents.css
│  │
│  ├─img			画像を格納するフォルダ
│  │
│  ├─js			JavaScriptを格納するフォルダ
│  │      common.js
│  │      hpCore.js
│  │      jquery-2.1.1.min.js
│  │      other.js
│  │
│  └─video			動画ファイルを格納するフォルダ  
　
紹介、デモ用
/(ルート)
└─Introduction
    │  contents.xml
    │  index.html
    │
    ├─css
    │  │  common.css
    │  │  reset.css
    │  │
    │  ├─high
    │  │      contents.css
    │  │
    │  ├─low
    │  │      contents.css
    │  │
    │  └─middle
    │          contents.css
    │
    ├─img
    │
    ├─js
    │      common.js
    │      hpCore.js
    │      jquery-2.1.1.min.js
    │      other.js
    │
    └─video
```
### 2-5. 必須ファイル
#### 2-5-1. index.html  
PFは、コンテンツのトップページとしてindex.htmlを開きます。  
index.htmlをトップページとして実装してください。  
index.htmlは二つあります。別に記述した方がいいかも  

#### 2-5-2. contents.xml  
コンテンツを定義するファイルで、index.htmlと同じ階層に置きます。  
コンテンツ名がxmlファイルをパーシングしないと分からないなら、本棚などで表示する際にパフォーマンスが問題にならないか？  
これらはxmlフォーマットである必要がありますか？例えば、JSONならだめですか？  
有効期限の開始日は必要か？  
有効期限をここに書いておくのは改ざんのリスクがあるのでは？  
ここの項目で十分か確認が必要ですね。

| 項目名 | 内容 |備考 |
|--------------------|------------|------------|
| materialId         |教材ID        |        |
| Subjected          |科目ID        |      |
| subjectGrade       |対象学年       |     |
| contentName        |コンテンツ名     |   |
| expirationDataFrom |有効期限（開始）|    |
| expirationDataTo   |有効期限（終了）|     |
サンプルコード
```xml
<?xml version="1.0" encoding="UTF-8"?>
<contents-manifest xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!-- 教材ID -->
  <materialId>1</materialId>
  <!-- 科目ID -->
  <subjectId>2</subjectId>
  <!-- 対象学年 -->
  <subjectGrade>2</subjectGrade>
  <!-- コンテンツ名 -->
  <contentName>漢字ドリル</contentName>
  <!-- 有効期限(開始) -->
  <expirationDataFrom>2014/04/01</expirationDataFrom> <!-- ※要暗号化 -->
  <!-- 有効期限(終了) -->
  <expirationDataTo>2015/03/31</expirationDataTo> <!-- ※要暗号化 -->
</contents-manifest>
```
### 2-6. 各ファイルの概要

#### 2-6-1. common.css  
コンテンツに使用するCSSファイル。

#### 2-6-2. reset.css  
初めから設定されているスタイルをリセットするCSSファイル。

#### 2-6-3. contents.css  
端末の解像度に合わせたCSSファイル。  
解像度の高さにより使用するフォルダを変更します。  
端末の解像度により、それぞれ高解像度のものはhigh、中解像度のものは middle、低解像度のものはlowのフォルダに格納されているcontents.cssを使用します。  
「端末の種類を判断して正しいcssを適用する」ことはどこの役割ですか？コンテンツ？PF?

#### 2-6-4. common.js  
PF共通の機能が記述されているJavaScriptファイル。

#### 2-6-5. hpCore.js  
PFとコンテンツとでやり取りするためのJavaScriptライブラリファイル。  
名前はどういう意味ですか？ファイル名から役割が推測できたらもっといいと思います。  
＞ hpはhimawari pocketの略です。PFのコアライブラリとして命名しましたが、別途考えます。

#### 2-6-6. jquery-2.1.1.min.js  
jQuery 2.1.1を使用するためのJavaScriptライブラリファイル。

### 2-7. コンテンツの保護  
インストールされたコンテンツの中身(※)は暗号化等によって保護します。  
ただし、コンテンツ利用中に画面のキャプチャを撮る事は可能です。  
※画像、動画など

### 2-8. コンテンツの規約  
コンテンツを制作する上での規約を記載します。

#### 2-8-1. 文字コード  
HTMLヘッダ情報、JavaScript、CSSなどを記述する際のファイルの文字コードはUTF-8とします。

#### 2-8-2. ヘッダ情報  
コンテンツ向けに下記囲みの内容をヘッダとしてHTMLに記述します。
```html
<meta charset="utf-8">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width,initial-scale=1,
user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="X-UA-Compatible" content="IE=9">
<title></title>
<link rel="stylesheet" type="text/css" href="./css/reset.css">
<link rel="stylesheet" type="text/css" href="./css/common.css">
<link rel="stylesheet" type="text/css" href="./css/low/contents.css" id="style-content">
<script type="text/javascript" src="./js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="./js/hpCore.js"></script>
<script type="text/javascript" src="./js/common.js"></script>
```
#### 2-8-3. ファイル参照方法  
コンテンツ内に記述される画像やリンク等のパス指定は、カレントディレクトリからの相対パスで指定してください。  
コンテンツはオフラインで実行されるので、Webサーバ経由を前提としたファイルを参照しないように実装してください。  
「絶対パスを前提にした」でよくないですか？Webサーバーを前提にすることはほぼないと思うし、必要な時にはしょうがないかな？  
＞絶対パスはコンテンツ側から見えないので相対パスとしています。  
＞Webサーバ経由云々の記述は削除しましょうか。

#### 2-8-4. マルチ解像度対応  
コンテンツはマルチ解像度に対応した作りにする必要があります。  
PFが解像度に応じてCSSを切り替えます。  
コンテンツ製作者は、高解像度、中解像度、低解像度のデザインを実装する必要があります。  
解像度一覧

| 区分 | 解像度 |
|-------|------------|
|高解像度 | 1920px×1080px|
|中解像度 | 1366px×768px  or  1280px×800px|
|低解像度 | 1024px×768px|


## 3.テンプレートの使用方法

### 3-1. メインコンテンツ用

#### 3-1-1. トップページ（カバーページ）

#### 3-1-2. 目次ページ

#### 3-1-3. 各コンテンツページ

### 3-2. 紹介・デモ用

#### 3-2-1. トップページ

## 4 . PF標準機能  
コンテンツで独自に実装を行わなくても使用することができる、PFの標準機能について記載します。

### 4-1. 印刷  
現在表示されているコンテンツを印刷することができます。
PF共有機能 [印刷ボタン表示] を呼び出すことで、PF画面に印刷ボタンが表示されます。

### 4-2. ストップウォッチ  
デジタル、アナログ表示のストップウォッチを使用することができます。  
PF共有機能 [ストップウォッチ表示] を呼び出すことで、PF画面にストップウォッチアイコンが表示されます。  
ストップウォッチは単独のアプリとして別ウィンドウで表示されます。

### 4-3. 描画ツール  
コンテンツ上の任意の領域に描画するツールを使用することができます。  
PF共有機能 [描画ツール表示] を呼び出すことで、PF画面に描画ツールが表示されます。  

### 4-4. 学習履歴の出力  
PFに保存している学習履歴をCSV形式で出力することができます。  
PFの設定画面（管理画面）から出力します。  

### 4-5. アクセスログ出力  
PFに保存している画面遷移のアクセスログをCSV形式で出力することができます。  
PFの設定画面（管理画面）から出力します。  

### 4-6. 認証・認可  
画面ロード時にPFの機能を自動で呼び出し、認証・認可を行います。  
認証に失敗した場合は、エラーメッセージを出力し、空白ページを表示します。  
PFを経由せず、HTMLファイルを直接起動した場合もエラーとなります。  
認証情報はPF側で一元管理するので、コンテンツ側で保持する必要はありません。  

### 4-7. 有効期間チェック  
認証・認可の際、コンテンツの有効期間をチェックします。
有効期間を過ぎたコンテンツは起動できません。  
有効期間はPF側で一元管理するので、コンテンツ側で保持する必要はありません。

### 4-8. 解像度に応じたCSS切替  
マルチ解像度に対応させるため、解像度に応じて、自動的にCSSを切り替えます。

## 5 . PF共有機能の使用方法  
PFが用意している共有機能についての使用方法と、共有機能を使用したサンプルのコードを記載します。

### 5-1. 操作者情報取得  
【機能】  
現在、PFを利用している操作者情報を取得します。<br>  
【関数名】hpGetUserInfo  
【パラメータ】  
　なし  
【戻り値】  
　操作者情報 : JSON形式  
　　・grade 学年  
　　・class クラス  
　　・number 出席番号  
(例)
{ “grade” : 2, “class” : 3, “number” : 15 } <br>  
サンプルコード
```js
// 操作者情報を取得します。
Var userInfo = hpGetUserInfo ();
```
### 5-2. 学習履歴保存  
【機能】  
PFに学習履歴を保存します。  
ドリル等で問題を解いた際に呼び出します。<br>  
【関数名】hpSaveHistory  
【パラメータ】  
　・history  
　　JSON形式 未定  
【戻り値】<br>
　なし<br>  
【サンプルコード】
```
未定
```

### 5-3. 外部ファイル起動  
【機能】  
PF上から外部のファイルを実行します。  
起動パラメータを渡すことも可能です。  
Windowsの「ファイル名を指定して実行」と同様の動きになります。<br>  
【関数名】 hpRunExternalFile  
【パラメータ】  
　・filePath  
　　　 String   実行するファイルパス（相対パス）  
　・args  
　　　 String   起動パラメータ（省略可能)複数パラメータの場合は、  
　　　　　　 スペースで区切ります。“.”で始まる場合は、相対パスの指定とみなします。  
【戻り値】  
　処理結果  
　　　 Boolean
(true:成功、false:失敗)<br>  
サンプルコード
```js
// メモ帳を起動
var filePath = "notepad";
var args = "./index.html";
return hpRunExternalFile(filePath, args);
```
ここに書かれている関数名等は固定ですか？あるいはこちらで指定できるものですか？  
もし指定できるならもっと分かりやすい名前にしたいと思います。  
＞関数名は固定です。名前は見直します。

### 5-4. エクスプローラ起動  
【機能】  
PF上からエクスプローラを起動します。<br>  
【関数名】
hpRunExplorer  
【パラメータ】  
　・folderPath  
　　　 String 起動するフォルダパス(相対パス)  
　・fileName  
　　　 String 選択するファイル名(省略可)  
【戻り値】  
　処理結果  
　　　 Boolean(true:成功、false:失敗)<br>  
サンプルコード
```js
// メモ帳を起動
var folderPath = "./css";
var fileName = "common.css";
return hpRunExplorer(folderPath, fileName);
```


## 6 . 制約事項
[ 制約事項があれば記載する。※特になければ項目を削除する ]
